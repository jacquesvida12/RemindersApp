<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <div class="container">
        <div class="header">
            <h1>Dashboard</h1>
            <div class="nav-links">
                <a href="{{ url_for('get_tasks') }}">View All Tasks</a>
                {% if g.user %}
                <div class="profile-dropdown">
                    <a href="#" id="profile-toggle" class="profile-link">
                        <img src="{{ g.user.ProfilePictureUrl or url_for('static', filename='images/default_avatar.png') }}" alt="User Avatar" class="avatar-small">
                        <span>{{ g.user.Username }}</span>
                    </a>
                    <div id="profile-menu" class="dropdown-menu">
                        <a href="{{ url_for('profile') }}">View Profile</a>
                        <a href="{{ url_for('logout') }}" class="logout">Logout</a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card overdue">
                <h2>
                    <span>Overdue</span>
                    <span class="count">{{ dashboard.overdue|length }}</span>
                </h2>
                <ul class="task-list">
                    {% for task in dashboard.overdue %}
                        <li>
                            <span class="task-title">{{ task.Title }}</span>
                            <span class="task-due-date">{{ task.DueDate.strftime('%b %d') }}</span>
                        </li>
                    {% else %}
                        <p class="no-tasks-message">No overdue tasks. Great job!</p>
                    {% endfor %}
                </ul>
            </div>
            <div class="dashboard-card">
                <h2>
                    <span>Due Today</span>
                    <span class="count">{{ dashboard.due_today|length }}</span>
                </h2>
                <ul class="task-list">
                    {% for task in dashboard.due_today %}
                        <li>
                            <span class="task-title">{{ task.Title }}</span>
                            <span class="task-due-date">{{ task.DueDate.strftime('%I:%M %p') }}</span>
                        </li>
                    {% else %}
                        <p class="no-tasks-message">No tasks due today.</p>
                    {% endfor %}
                </ul>
            </div>
            <div class="dashboard-card">
                <h2>
                    <span>Due Next 7 Days</span>
                    <span class="count">{{ dashboard.due_this_week|length }}</span>
                </h2>
                <ul class="task-list">
                    {% for task in dashboard.due_this_week %}
                        <li>
                            <span class="task-title">{{ task.Title }}</span>
                            <span class="task-due-date">{{ task.DueDate.strftime('%a, %b %d') }}</span>
                        </li>
                    {% else %}
                        <p class="no-tasks-message">No upcoming tasks for the week.</p>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>